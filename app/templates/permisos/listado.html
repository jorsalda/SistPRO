{% extends "base.html" %}

{% block title %}Permisos{% endblock %}

{% block content %}

<h4 class="mb-3">ğŸ“‹ Listado de Permisos</h4>

<div class="d-flex justify-content-between align-items-center mb-3">
    <div></div>
    <div class="d-flex gap-2">
        {% if current_user.rol == 'admin' %}
        <a href="{{ url_for('docente.nuevo') }}" class="btn btn-info">
            ğŸ‘¨â€ğŸ« Nuevo Docente
        </a>
        {% endif %}
        <a href="{{ url_for('permiso.formulario') }}" class="btn btn-success">
            â• Nuevo Permiso
        </a>
    </div>
</div>

<!-- EstadÃ­sticas -->
<div class="row mb-4">
    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                <h3>{{ permisos|length }}</h3>
                <small class="text-muted">Total Permisos</small>
            </div>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card text-center">
            <div class="card-body">
                {% set activos = permisos|selectattr('fecha_fin', '>=', hoy)|list|length %}
                <h3>{{ activos }}</h3>
                <small class="text-muted">Permisos Activos</small>
            </div>
        </div>
    </div>
</div>

<!-- Tabla -->
<div class="card">
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0 align-middle">
                <thead class="table-primary">
                    <tr>
                        <th>Docente</th>
                        <th>Tipo</th>
                        <th>Desde</th>
                        <th>Hasta</th>
                        <th>DÃ­as</th>
                        <th>ObservaciÃ³n</th>
                        <th class="text-end">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for permiso in permisos %}
                    <tr>
                        <td><strong>{{ permiso.docente.nombre }}</strong></td>

                        <td>
                            {% if permiso.tipo == 'Vacaciones' %}
                                <span class="badge bg-info">ğŸ–ï¸ Vacaciones</span>
                            {% elif permiso.tipo == 'Enfermedad' %}
                                <span class="badge bg-danger">ğŸ¤’ Enfermedad</span>
                            {% elif permiso.tipo == 'CapacitaciÃ³n' %}
                                <span class="badge bg-primary">ğŸ“š CapacitaciÃ³n</span>
                            {% elif permiso.tipo == 'Permiso Personal' %}
                                <span class="badge bg-warning text-dark">ğŸ‘¤ Permiso Personal</span>
                            {% elif permiso.tipo == 'Licencia' %}
                                <span class="badge bg-secondary">ğŸ“„ Licencia</span>
                            {% elif permiso.tipo == 'Tiquetera de la felicidad' %}
                                <span class="badge bg-success">ğŸ‰ Tiquetera de la felicidad</span>
                            {% elif permiso.tipo == 'CumpleaÃ±os' %}
                                <span class="badge bg-warning text-dark">ğŸ‚ CumpleaÃ±os</span>
                            {% elif permiso.tipo == 'Jurado de votaciÃ³n' %}
                                <span class="badge bg-dark">ğŸ—³ï¸ Jurado de votaciÃ³n</span>
                            {% else %}
                                <span class="badge bg-secondary">â“ {{ permiso.tipo }}</span>
                            {% endif %}
                        </td>

                        <td>{{ permiso.fecha_inicio.strftime('%d/%m/%Y') }}</td>
                        <td>{{ permiso.fecha_fin.strftime('%d/%m/%Y') }}</td>

                        <td>
                            {% set dias = (permiso.fecha_fin - permiso.fecha_inicio).days + 1 %}
                            {% if dias > 10 %}
                                <span class="badge bg-danger">{{ dias }} dÃ­as</span>
                            {% elif dias > 5 %}
                                <span class="badge bg-warning text-dark">{{ dias }} dÃ­as</span>
                            {% else %}
                                <span class="badge bg-success">{{ dias }} dÃ­as</span>
                            {% endif %}
                        </td>

                        <td>{{ permiso.observacion or "-" }}</td>

                        <td class="text-end">
                            <div class="btn-group btn-group-sm" role="group">
                                <a href="{{ url_for('permiso.editar', id=permiso.id) }}"
                                   class="btn btn-outline-primary">
                                    âœï¸
                                </a>

                                <form action="{{ url_for('permiso.eliminar', id=permiso.id) }}"
                                      method="post"
                                      onsubmit="return confirm('Â¿Eliminar este permiso?')">
                                    <button type="submit" class="btn btn-outline-danger">
                                        ğŸ—‘ï¸
                                    </button>
                                </form>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="7" class="text-center py-4">
                            No hay permisos registrados
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

{% endblock %}
