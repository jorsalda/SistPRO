{% extends "base.html" %}

{% block title %}Nuevo Permiso{% endblock %}

{% block content %}

<h4 class="mb-4">‚ûï Registrar Nuevo Permiso</h4>

<!-- Mensajes flash -->
{% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
        {% for category, message in messages %}
            <div class="alert alert-{{ category }} alert-dismissible fade show">
                {{ message }}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        {% endfor %}
    {% endif %}
{% endwith %}

<div class="row">
    <!-- FORMULARIO A LA IZQUIERDA -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <!-- CORREGIDO: Usa permiso.nuevo en lugar de permiso.crear -->
                <form method="POST" action="{{ url_for('permiso.nuevo') }}" id="form-permiso">

                    <div class="mb-3">
                        <label for="docente_id" class="form-label">Docente *</label>
                        <select name="docente_id" id="docente_id" class="form-select" required>
                            <option value="">Seleccione un docente...</option>
                            {% for docente in docentes %}
                                <option value="{{ docente.id }}">
                                    {{ docente.nombre }}
                                    {% if docente.documento %}({{ docente.documento }}){% endif %}
                                </option>
                            {% endfor %}
                        </select>
                    </div>

                    <div class="mb-3">
                        <label for="tipo" class="form-label">Tipo de Permiso *</label>
                        <select name="tipo" id="tipo" class="form-select" required>
                            <option value="">Seleccione tipo...</option>
                            <option value="Vacaciones">Vacaciones</option>
                            <option value="Enfermedad">Enfermedad</option>
                            <option value="Capacitaci√≥n">Capacitaci√≥n</option>
                            <option value="Permiso Personal">Permiso Personal</option>
                            <option value="Licencia">Licencia</option>
                            <option value="Tiquetera de la felicidad">Tiquetera de la felicidad</option>
                            <option value="Cumplea√±os">Cumplea√±os</option>
                            <option value="Jurado de votaci√≥n">Jurado de votaci√≥n</option>
                        </select>
                    </div>

                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="fecha_inicio" class="form-label">Fecha de Inicio *</label>
                            <input type="date" name="fecha_inicio" id="fecha_inicio" class="form-control" required>
                        </div>

                        <div class="col-md-6">
                            <label for="fecha_fin" class="form-label">Fecha de Fin *</label>
                            <input type="date" name="fecha_fin" id="fecha_fin" class="form-control" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="observacion" class="form-label">Observaci√≥n</label>
                            <input type="text" name="observacion" id="observacion" class="form-control"
                               placeholder="Opcional">
                    </div>

                    <!-- Contenedor para mensajes AJAX (si usas env√≠o con AJAX) -->
                    <div id="mensaje-ajax" class="mb-3"></div>

                    <div class="d-flex justify-content-end gap-2">
                        <!-- CORREGIDO: permiso.listado est√° correcto -->
                        <a href="{{ url_for('permiso.listado') }}" class="btn btn-secondary">
                            ‚¨ÖÔ∏è Cancelar
                        </a>
                        <button type="submit" class="btn btn-success">
                            üíæ Registrar Permiso
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- HISTORIAL DE PERMISOS A LA DERECHA -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-header bg-info text-white">
                <h5 class="mb-0">üìã Historial de Permisos del Docente</h5>
            </div>
            <div class="card-body">
                <div id="mensaje-seleccion" class="alert alert-info">
                    üëà Seleccione un docente para ver su historial de permisos
                </div>

                <div id="loading" class="text-center d-none">
                    <div class="spinner-border text-primary" role="status">
                        <span class="visually-hidden">Cargando...</span>
                    </div>
                    <p>Cargando permisos...</p>
                </div>

                <div id="contenedor-permisos" class="d-none">
                    <h6 id="titulo-docente" class="mb-3"></h6>
                    <div id="lista-permisos" class="list-group"></div>
                    <div id="sin-permisos" class="alert alert-warning d-none">
                        Este docente no tiene permisos registrados
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Incluir el archivo JS separado -->
<script src="{{ url_for('static', filename='js/formulario-permiso.js') }}"></script>

{% endblock %}